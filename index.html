<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Nafuzor Project</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #000000;
            --glass-bg: rgba(28, 28, 30, 0.65);
            --glass-border: rgba(255, 255, 255, 0.12);
            --primary: #0a84ff;
            --success: #30d158;
            --danger: #ff453a;
            --warning: #ffd60a;
            --text-main: #ffffff;
            --text-sec: #8e8e93;
            --card-radius: 20px;
        }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Outfit', sans-serif;
            background: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1c1c1e 0%, #000000 80%);
            color: var(--text-main);
            min-height: 100vh;
            overflow: hidden;
            user-select: none; -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- UI ELEMENTS --- */
        .page {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            padding: 20px 16px 80px 16px; box-sizing: border-box;
            display: flex; flex-direction: column; align-items: center;
            overflow-y: auto; overflow-x: hidden;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.3s ease;
            background: transparent;
        }
        .page-active { transform: translateX(0); opacity: 1; z-index: 2; pointer-events: auto; }
        .page-hidden-left { transform: translateX(-30%); opacity: 0; z-index: 1; pointer-events: none; }
        .page-hidden-right { transform: translateX(100%); opacity: 0; z-index: 1; pointer-events: none; }

        header { width: 100%; display: flex; justify-content: center; align-items: center; position: relative; height: 44px; margin-bottom: 20px; flex-shrink: 0; }
        h1 { font-size: 17px; font-weight: 600; letter-spacing: -0.4px; margin: 0; }
        .back-btn { position: absolute; left: 0; top: 0; height: 100%; display: flex; align-items: center; color: var(--primary); font-size: 17px; cursor: pointer; gap: 5px; }

        .glass-card {
            width: 100%; max-width: 400px;
            background: var(--glass-bg); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border); border-radius: var(--card-radius);
            padding: 20px; margin-bottom: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .profile-header { display: flex; align-items: center; gap: 15px; position: relative; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #333, #111); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; border: 1px solid rgba(255,255,255,0.1); }
        .profile-info { flex: 1; }
        .profile-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 2px; }
        .profile-balance { font-size: 0.9rem; color: var(--text-sec); }
        .balance-val { color: var(--text-main); font-weight: 600; }
        
        .status-badge {
            position: absolute; top: 0; right: 0; padding: 6px 12px; border-radius: 20px;
            font-size: 12px; font-weight: 600; text-transform: uppercase;
            backdrop-filter: blur(10px); transition: all 0.3s ease;
        }
        .status-full { background: rgba(48, 209, 88, 0.15); color: var(--success); border: 1px solid rgba(48, 209, 88, 0.3); }
        .status-stop { background: rgba(255, 69, 58, 0.15); color: var(--danger); border: 1px solid rgba(255, 69, 58, 0.3); }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 400px; }
        .menu-btn {
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: var(--card-radius);
            padding: 16px; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between;
            cursor: pointer; transition: transform 0.1s;
        }
        .menu-btn:active { transform: scale(0.97); background: rgba(255,255,255,0.1); }
        .menu-btn.full { grid-column: span 2; flex-direction: row; align-items: center; min-height: 70px; }
        .menu-icon { width: 32px; height: 32px; border-radius: 10px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; color: var(--primary); margin-bottom: 10px; }
        .menu-btn.full .menu-icon { margin-bottom: 0; margin-right: 15px; }
        .menu-title { font-weight: 600; font-size: 15px; }
        .menu-desc { font-size: 12px; color: var(--text-sec); margin-top: 4px; }

        .ios-list { width: 100%; max-width: 400px; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: 14px; overflow: hidden; margin-bottom: 20px; }
        .ios-item { padding: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.08); font-size: 16px; }
        .ios-item:last-child { border-bottom: none; }
        .ios-label { color: var(--text-sec); }
        .ios-val { font-weight: 500; color: var(--text-main); text-align: right; }

        .action-btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 14px; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .action-btn:active { opacity: 0.8; transform: scale(0.98); }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        
        .custom-input { width: 100%; padding: 16px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 14px; color: white; font-size: 18px; outline: none; box-sizing: border-box; }
        .custom-input:focus { border-color: var(--primary); }

        .cat-selector { display: flex; gap: 10px; width: 100%; max-width: 400px; margin-bottom: 20px; }
        .cat-btn { flex: 1; padding: 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; text-align: center; cursor: pointer; transition: 0.2s; }
        .cat-btn.selected { border-color: var(--primary); background: rgba(10, 132, 255, 0.15); }

        .copy-row { display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.3); padding: 10px 14px; border-radius: 12px; margin-top: 8px; cursor: pointer; }
        .selectable { user-select: text; -webkit-user-select: text; }
        .toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) scale(0.9); background: rgba(40,40,40,0.9); backdrop-filter: blur(10px); color: white; padding: 12px 24px; border-radius: 30px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 2000; box-shadow: 0 10px 40px rgba(0,0,0,0.4); }
        .toast.show { transform: translateX(-50%) scale(1); opacity: 1; }

        .sub-accordion { background: rgba(255,255,255,0.05); border-radius: 14px; margin-bottom: 10px; overflow: hidden; }
        .sub-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 600; }
        .sub-body { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; background: rgba(0,0,0,0.2); }
        .sub-body.open { max-height: 500px; }
        .sub-content { padding: 15px; font-size: 14px; color: var(--text-sec); line-height: 1.5; }
        .styled-list { list-style: none; padding: 0; margin: 0; }
        .styled-list li { position: relative; padding-left: 15px; margin-bottom: 8px; }
        .styled-list li::before { content: ''; position: absolute; left: 0; top: 6px; width: 6px; height: 6px; background: var(--primary); border-radius: 50%; }
        .icon-row { display: flex; gap: 10px; margin-bottom: 15px; font-size: 14px; color: var(--text-sec); }
        .video-wrapper { width: 100%; border-radius: 14px; overflow: hidden; margin-bottom: 15px; background: #000; border: 1px solid rgba(255,255,255,0.1); }
        video { width: 100%; display: block; }
    </style>
</head>
<body>

    <div id="toast" class="toast"><span>–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ</span></div>

    <!-- ===== –ì–õ–ê–í–ù–ê–Ø ===== -->
    <div id="page-home" class="page page-active">
        <header><h1>NAFUZOR PROJECT</h1></header>

        <div class="glass-card">
            <div id="status-badge" class="status-badge status-full">Loading...</div>
            <div class="profile-header">
                <div id="user-avatar" class="avatar">NP</div>
                <div class="profile-info">
                    <div id="user-name" class="profile-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div class="profile-balance">–ë–∞–ª–∞–Ω—Å: <span id="profile-balance-val" class="balance-val">0 ‚ÇΩ</span></div>
                </div>
            </div>
        </div>

        <div style="margin-top: 10px; width: 100%; max-width: 400px;">
            <button class="action-btn" onclick="navigateTo('page-menu')">
                –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>
        
        <div style="margin-top: 15px; width: 100%; max-width: 400px; text-align: center;">
            <span class="menu-desc" onclick="navigateTo('page-instructions')" style="text-decoration: underline; cursor:pointer;">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –ø–æ–º–æ—â—å</span>
        </div>
    </div>

    <!-- ===== –ú–ï–ù–Æ ===== -->
    <div id="page-menu" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–ú–µ–Ω—é</h1>
        </header>
        <div class="menu-grid">
            <div class="menu-btn" onclick="navigateToAddNumber()">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"></path></svg></div><span class="menu-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä</span>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-my-nums')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg></div><span class="menu-title">–ú–æ–∏ –Ω–æ–º–µ—Ä–∞</span>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-ref')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div><span class="menu-title">–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</span>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-card')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg></div><span class="menu-title">–ö–∞—Ä—Ç–∞</span>
            </div>
            <div class="menu-btn full" onclick="navigateTo('page-sub')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg></div>
                <div><span class="menu-title">–ü–æ–¥–ø–∏—Å–∫–∞</span><div class="menu-desc">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–º</div></div>
            </div>
        </div>
    </div>

    <!-- –î–û–ë–ê–í–ò–¢–¨ –ù–û–ú–ï–† -->
    <div id="page-add" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä</h1>
        </header>
        <div class="input-label" style="text-align:center; margin-bottom:15px; color:#888;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
        <div class="cat-selector">
            <div class="cat-btn" id="cat-max" onclick="selectCategory('MAX')"><span class="cat-name">MAX</span></div>
            <div class="cat-btn" id="cat-wa" onclick="selectCategory('WhatsApp')"><span class="cat-name">WhatsApp</span></div>
        </div>
        <div id="add-input-container" style="display:none; width: 100%; max-width: 400px;">
            <div class="input-group" style="margin-bottom:20px;">
                <input type="tel" id="phone-input" class="custom-input" placeholder="+7...">
            </div>
            <button class="action-btn" onclick="submitNumber()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–û–ò –ù–û–ú–ï–†–ê -->
    <div id="page-my-nums" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–ú–æ–∏ –Ω–æ–º–µ—Ä–∞</h1>
        </header>
        <div class="menu-grid" style="margin-bottom: 20px;">
            <div class="menu-btn" onclick="filterNumbers('–í —Ä–∞–±–æ—Ç–µ')">
                <div class="menu-icon" style="color:var(--primary)"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div><span class="menu-title">–í —Ä–∞–±–æ—Ç–µ</span>
            </div>
            <div class="menu-btn" onclick="filterNumbers('–û–∂–∏–¥–∞–µ—Ç')">
                <div class="menu-icon" style="color:var(--warning)"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="menu-title">–û–∂–∏–¥–∞–µ—Ç</span>
            </div>
            <div class="menu-btn" onclick="filterNumbers('–£—Å–ø–µ—Ö')">
                <div class="menu-icon" style="color:var(--success)"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="menu-title">–£—Å–ø–µ—Ö</span>
            </div>
            <div class="menu-btn" onclick="filterNumbers('–ë–ª–æ–∫')">
                <div class="menu-icon" style="color:var(--danger)"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path></svg></div><span class="menu-title">–ë–ª–æ–∫</span>
            </div>
        </div>
        <div id="nums-list" class="ios-list" style="display:none; background:transparent;"></div>
        <div id="nums-empty" style="color: var(--text-sec); text-align: center; margin-top: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
    </div>

    <!-- –†–ï–§–ï–†–ê–õ–ö–ê -->
    <div id="page-ref" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–ü–∞—Ä—Ç–Ω–µ—Ä–∞–º</h1>
        </header>
        <div class="glass-card">
            <div style="font-size: 14px; color: var(--text-sec); margin-bottom: 10px;">–ó–∞ –∫–∞–∂–¥—É—é –ø–æ–∫—É–ø–∫—É –¥—Ä—É–≥–∞: <span style="color:var(--success); font-weight:700;">15%</span></div>
            <div class="ios-list" style="margin-bottom: 15px; background: rgba(0,0,0,0.2);">
                <div class="ios-item"><span class="ios-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ:</span><span class="ios-val" id="ref-count">0</span></div>
            </div>
            <div class="input-label" style="color:#888; font-size:14px; margin-bottom:5px;">–¢–≤–æ—è —Å—Å—ã–ª–∫–∞:</div>
            <div class="copy-row" onclick="copyRefLink()">
                <div id="ref-link-text" class="selectable" style="flex:1; font-size:13px; font-family:monospace; color:var(--primary); overflow:hidden; white-space:nowrap;">...</div>
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
            </div>
        </div>
        <button class="action-btn" onclick="shareLink()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
    </div>

    <!-- –ö–ê–†–¢–ê -->
    <div id="page-card" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–ö–∞—Ä—Ç–∞</h1>
        </header>
        <div class="glass-card" style="background: linear-gradient(135deg, #1c1c1e, #000); border: 1px solid rgba(255,255,255,0.15);">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><span style="font-weight:700; font-size:18px;">NAFUZOR</span></div>
            <div style="margin-bottom:15px;">
                <div style="font-size:12px; color:#888;">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
                <div class="selectable" id="card-num" style="font-family:monospace; font-size:20px; letter-spacing:2px; margin-top:4px;">****</div>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <div><div style="font-size:12px; color:#888;">–ë–∞–ª–∞–Ω—Å</div><div id="card-bal" style="font-size:16px; font-weight:600;">0.00 ‚ÇΩ</div></div>
                <div><div style="font-size:12px; color:#888;">CVV</div><div class="selectable" id="card-cvv" style="font-size:16px; font-weight:600;">***</div></div>
            </div>
            <div style="margin-top:15px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px; font-size:12px; color:#666;">–ê–∫—Ç–∏–≤–∞—Ü–∏—è: <span id="card-date">--.--.--</span></div>
        </div>
        <button class="action-btn btn-outline" onclick="showApiToken()">–ü–æ–∫–∞–∑–∞—Ç—å API —Ç–æ–∫–µ–Ω</button>
    </div>

    <!-- –ü–û–î–ü–ò–°–ö–ê -->
    <div id="page-sub" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–ü–æ–¥–ø–∏—Å–∫–∞</h1>
        </header>
        <div class="glass-card" style="text-align:center;">
            <div style="font-size:40px; margin-bottom:10px;">üíé</div>
            <div style="font-size:14px; color:var(--text-sec);">–¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</div>
            <div id="user-sub-name" style="font-size:24px; font-weight:700; color:var(--primary); margin:10px 0;">...</div>
        </div>
    </div>

    <!-- –ò–ù–°–¢–†–£–ö–¶–ò–ò -->
    <div id="page-instructions" class="page page-hidden-right">
        <header>
            <div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div>
            <h1>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h1>
        </header>
        <div class="menu-grid">
            <div class="menu-btn full" onclick="navigateTo('page-instr-add')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
                <div><span class="menu-title">–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä</span></div>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-instr-subs')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div><span class="menu-title">–ü–æ–¥–ø–∏—Å–∫–∏</span>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-instr-ref')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div><span class="menu-title">–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</span>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-instr-card')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg></div><span class="menu-title">–ö–∞—Ä—Ç–∞</span>
            </div>
            <div class="menu-btn" onclick="navigateTo('page-instr-limits')">
                <div class="menu-icon"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><span class="menu-title">–õ–∏–º–∏—Ç—ã</span>
            </div>
        </div>
    </div>

    <!-- –°–¢–†–ê–ù–ò–¶–´ –ò–ù–°–¢–†–£–ö–¶–ò–ô (–ö–û–ù–¢–ï–ù–¢) -->
    <div id="page-instr-add" class="page page-hidden-right">
        <header><div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div><h1>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ</h1></header>
        <div class="glass-card">
            <div class="video-wrapper"><video controls loop muted playsinline><source src="n.mp4" type="video/mp4"></video></div>
            <p style="color:var(--text-sec); font-size:14px;">–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</p>
            <ul class="styled-list"><li>–û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π.</li><li>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä".</li><li>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.</li><li>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä.</li></ul>
        </div>
    </div>
    <div id="page-instr-subs" class="page page-hidden-right">
        <header><div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div><h1>–ü–æ–¥–ø–∏—Å–∫–∏</h1></header>
        <div style="width:100%; max-width:400px;">
            <div class="sub-accordion" onclick="toggleSub(this)"><div class="sub-header"><span>Alpha</span><span>‚ñº</span></div><div class="sub-body"><div class="sub-content"><p>1 —á–∞—Å ‚Äî 6$<br>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω ‚Äî 3$</p></div></div></div>
            <div class="sub-accordion" onclick="toggleSub(this)"><div class="sub-header"><span>Nucleus</span><span>‚ñº</span></div><div class="sub-body"><div class="sub-content"><p>1 —á–∞—Å ‚Äî 9$<br>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω ‚Äî 4.5$</p></div></div></div>
            <div class="sub-accordion" onclick="toggleSub(this)"><div class="sub-header"><span>Zero Limits</span><span>‚ñº</span></div><div class="sub-body"><div class="sub-content"><p>1 —á–∞—Å ‚Äî 15$<br>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω ‚Äî 7.5$</p></div></div></div>
        </div>
    </div>
    <div id="page-instr-ref" class="page page-hidden-right"><header><div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div><h1>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</h1></header><div class="glass-card"><p>–ü–æ–ª—É—á–∞–π—Ç–µ 15% —Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –¥—Ä—É–∑–µ–π.</p></div></div>
    <div id="page-instr-card" class="page page-hidden-right"><header><div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div><h1>–û –ö–∞—Ä—Ç–µ</h1></header><div class="glass-card"><p>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–ª—è –≤—ã–ø–ª–∞—Ç.</p></div></div>
    <div id="page-instr-limits" class="page page-hidden-right"><header><div class="back-btn" onclick="goBack()"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 19l-7-7 7-7"></path></svg>–ù–∞–∑–∞–¥</div><h1>–õ–∏–º–∏—Ç—ã</h1></header><div class="glass-card"><p>–ù—É–∂–µ–Ω Username –∏ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª—ã.</p></div></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#000000');
        tg.setBackgroundColor('#000000');

        let userData = { uid:0, bal:0, sub:'None', ref:0, cn:'..', cb:0, cc:'..', cd:'..', ct:'..', nums:[] };

        // 1. –ß–¢–ï–ù–ò–ï –î–ê–ù–ù–´–• –ò–ó URL
        function parseData() {
            try {
                const params = new URLSearchParams(window.location.search);
                const raw = params.get('data');
                if(raw) {
                    const decoded = JSON.parse(decodeURIComponent(raw));
                    userData = decoded;
                }
            } catch(e) { console.error('Error parsing data:', e); }
            updateUI();
        }

        // 2. –û–ë–ù–û–í–õ–ï–ù–ò–ï UI
        function updateUI() {
            const user = tg.initDataUnsafe.user;
            if(user) {
                document.getElementById('user-name').innerText = user.first_name;
                if(user.photo_url) document.getElementById('user-avatar').innerHTML = `<img src="${user.photo_url}" style="width:100%; height:100%; border-radius:50%;">`;
                else document.getElementById('user-avatar').innerText = user.first_name[0];
            }

            document.getElementById('profile-balance-val').innerText = userData.bal + " ‚ÇΩ";
            document.getElementById('ref-count').innerText = userData.ref + " —á–µ–ª.";
            document.getElementById('ref-link-text').innerText = "t.me/nafuzor_bot?start=" + userData.uid;
            document.getElementById('user-sub-name').innerText = (userData.sub || 'None').toUpperCase();
            
            document.getElementById('card-num').innerText = userData.cn;
            document.getElementById('card-bal').innerText = userData.cb + " ‚ÇΩ";
            document.getElementById('card-cvv').innerText = userData.cc;
            document.getElementById('card-date').innerText = userData.cd;

            updateStatus();
        }

        // 3. –û–¢–ü–†–ê–í–ö–ê –ù–û–ú–ï–†–ê
        function submitNumber() {
            const input = document.getElementById('phone-input').value.trim();
            let isValid = (selectedCat === 'MAX') ? /^\+7\d{10}$/.test(input) : /^9\d{9}$/.test(input);

            if (isValid) {
                // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –î–ê–ù–ù–´–ï –ë–û–¢–£ (–∑–∞–∫—Ä–æ–µ—Ç –æ–∫–Ω–æ)
                tg.sendData(JSON.stringify({
                    action: 'add_number',
                    category: selectedCat,
                    number: input
                }));
            } else {
                tg.showPopup({title: '–û—à–∏–±–∫–∞', message: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç'});
            }
        }

        // 4. –§–ò–õ–¨–¢–† –ù–û–ú–ï–†–û–í (–ë–ï–†–ï–¢ –ò–ó userData.nums)
        function filterNumbers(status) {
            const list = document.getElementById('nums-list');
            const empty = document.getElementById('nums-empty');
            list.innerHTML = '';
            
            const filtered = (userData.nums || []).filter(n => n.s === status);
            
            if (filtered.length > 0) {
                list.style.display = 'block'; empty.style.display = 'none';
                filtered.forEach(n => {
                    let color = '#fff';
                    if(status === '–í —Ä–∞–±–æ—Ç–µ') color = '#0a84ff';
                    else if(status === '–û–∂–∏–¥–∞–µ—Ç') color = '#ffd60a';
                    else if(status === '–£—Å–ø–µ—Ö') color = '#30d158';
                    else if(status === '–ë–ª–æ–∫') color = '#ff453a';
                    
                    const item = document.createElement('div');
                    item.className = 'ios-item';
                    item.innerHTML = `<div style="display:flex; align-items:center; gap:10px;"><div style="width:10px; height:10px; border-radius:50%; background:${color};"></div><span>${n.n}</span></div><span class="ios-label" style="font-size:12px;">${n.c}</span>`;
                    list.appendChild(item);
                });
            } else {
                list.style.display = 'none'; empty.style.display = 'block';
                empty.innerText = '–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—É—Å—Ç–æ';
            }
        }

        // –£–¢–ò–õ–ò–¢–´
        function updateStatus() {
            const h = new Date().getHours();
            const b = document.getElementById('status-badge');
            if (h >= 8 && h < 20) { b.innerText = 'üü¢ Full Work'; b.className = 'status-badge status-full'; }
            else { b.innerText = 'üî¥ Stop Work'; b.className = 'status-badge status-stop'; }
        }
        function copyRefLink() { navigator.clipboard.writeText(document.getElementById('ref-link-text').innerText).then(() => showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ')); }
        function shareLink() { tg.openTelegramLink("https://t.me/share/url?url=" + document.getElementById('ref-link-text').innerText); }
        function showApiToken() { tg.showPopup({title:'API', message: userData.ct}); }
        function showToast(txt) { const t=document.getElementById('toast'); t.querySelector('span').innerText=txt; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000); }
        function toggleSub(el) { const b=el.querySelector('.sub-body'); if(b.classList.contains('open')) b.classList.remove('open'); else b.classList.add('open'); }

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        let historyStack = [], selectedCat = null;
        function navigateTo(pid) {
            const active = document.querySelector('.page-active'); const target = document.getElementById(pid);
            if(!target || active===target) return;
            active.classList.remove('page-active'); active.classList.add('page-hidden-left');
            target.classList.remove('page-hidden-right'); target.classList.add('page-active');
            historyStack.push(active.id);
        }
        function goBack() {
            if(!historyStack.length) return;
            const pid = historyStack.pop();
            const active = document.querySelector('.page-active'); const prev = document.getElementById(pid);
            active.classList.remove('page-active'); active.classList.add('page-hidden-right');
            prev.classList.remove('page-hidden-left'); prev.classList.add('page-active');
        }
        function navigateToAddNumber() {
            navigateTo('page-add'); document.getElementById('add-input-container').style.display='none';
            document.getElementById('phone-input').value=''; selectedCat=null;
            document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('selected'));
        }
        function selectCategory(cat) {
            selectedCat=cat;
            document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('selected'));
            if(cat==='MAX') { document.getElementById('cat-max').classList.add('selected'); document.getElementById('phone-input').placeholder='+7999...'; }
            else { document.getElementById('cat-wa').classList.add('selected'); document.getElementById('phone-input').placeholder='999...'; }
            document.getElementById('add-input-container').style.display='block';
        }

        window.onload = parseData;
    </script>
</body>
</html>
