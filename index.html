<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qibys Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --accent: #007aff; /* Telegram Blue */
            --accent-gradient: linear-gradient(90deg, #007aff, #00c6ff);
            --gold: #ffcc00;
            --text-main: #ffffff;
            --text-sec: #8e8e93;
            --danger: #ff3b30;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 80px; /* –ú–µ—Å—Ç–æ –¥–ª—è –Ω–∏–∂–Ω–µ–≥–æ –º–µ–Ω—é */
        }

        /* --- Header --- */
        .header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(28, 28, 30, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #333;
        }

        .user-block {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #333;
            object-fit: cover;
        }

        .username {
            font-weight: 700;
            font-size: 16px;
        }

        .balance-badge {
            background: rgba(255, 204, 0, 0.15);
            color: var(--gold);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- Tabs Content --- */
        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Cards --- */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        h3 { margin-top: 0; margin-bottom: 10px; font-size: 18px; }
        p { color: var(--text-sec); font-size: 14px; margin-bottom: 15px; }

        /* --- Shop Items --- */
        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .item {
            background: #2c2c2e;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .item-icon { font-size: 30px; margin-bottom: 10px; }
        .item-name { font-weight: 600; margin-bottom: 5px; font-size: 14px; }
        .item-price { color: var(--gold); font-weight: 700; font-size: 14px; margin-bottom: 10px; }
        
        .buy-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
        }

        .buy-btn:active { opacity: 0.7; transform: scale(0.98); }

        /* --- Referral Section --- */
        .ref-box {
            background: #000;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .ref-link {
            background: transparent;
            border: none;
            color: var(--text-main);
            width: 80%;
            outline: none;
            font-family: monospace;
        }

        .copy-icon {
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        /* --- Bottom Navigation --- */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 200;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-sec);
            font-size: 11px;
            cursor: pointer;
            transition: 0.2s;
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        /* --- Loader --- */
        #loader {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            transition: opacity 0.5s;
        }
    </style>
</head>
<body>

    <!-- Loader -->
    <div id="loader">
        <div style="color: var(--accent); font-weight: bold;">–ó–ê–ì–†–£–ó–ö–ê...</div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="user-block">
            <img id="avatar" src="https://via.placeholder.com/50" class="avatar" alt="Ava">
            <div>
                <div class="username" id="username">Guest</div>
                <div style="font-size: 12px; color: #888;">ID: <span id="userid">...</span></div>
            </div>
        </div>
        <div class="balance-badge">
            <span id="stars-balance">0</span> ‚òÖ
        </div>
    </header>

    <!-- –í–∫–ª–∞–¥–∫–∞: –ú–∞–≥–∞–∑–∏–Ω -->
    <div id="tab-shop" class="tab-content active">
        <div class="card" style="background: linear-gradient(135deg, #2b0052, #180036);">
            <h3>üíé Premium –°—Ç–∞—Ç—É—Å</h3>
            <p>–î–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–∞–Ω–∞–ª—É –∏ –∑–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞.</p>
            <button class="buy-btn" onclick="buyItem('premium_1', 50)" style="background: var(--gold); color: black;">
                –ö—É–ø–∏—Ç—å –∑–∞ 50 ‚òÖ
            </button>
        </div>

        <h3>–¢–æ–≤–∞—Ä—ã</h3>
        <div class="shop-grid">
            <div class="item">
                <div class="item-icon">‚ö°Ô∏è</div>
                <div class="item-name">–≠–Ω–µ—Ä–≥–∏—è</div>
                <div class="item-price">10 ‚òÖ</div>
                <button class="buy-btn" onclick="buyItem('energy_10', 10)">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="item">
                <div class="item-icon">üöÄ</div>
                <div class="item-name">–ë—É—Å—Ç x2</div>
                <div class="item-price">25 ‚òÖ</div>
                <button class="buy-btn" onclick="buyItem('boost_2', 25)">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="item">
                <div class="item-icon">üéÅ</div>
                <div class="item-name">–õ—É—Ç–±–æ–∫—Å</div>
                <div class="item-price">100 ‚òÖ</div>
                <button class="buy-btn" onclick="buyItem('lootbox', 100)">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="item">
                <div class="item-icon">üëë</div>
                <div class="item-name">VIP –ß–∞—Ç</div>
                <div class="item-price">500 ‚òÖ</div>
                <button class="buy-btn" onclick="buyItem('vip_chat', 500)">–ö—É–ø–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞: –ü—Ä–æ—Ñ–∏–ª—å -->
    <div id="tab-profile" class="tab-content">
        <div class="card">
            <h3>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
            <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π 10% –æ—Ç –∏—Ö –ø–æ–∫—É–ø–æ–∫.</p>
            <div class="ref-box">
                <input type="text" id="ref-link" class="ref-link" readonly value="–ó–∞–≥—Ä—É–∑–∫–∞...">
                <span class="copy-icon" onclick="copyRef()">üìã</span>
            </div>
            <button class="buy-btn" style="margin-top: 15px;" onclick="share()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
        </div>

        <div class="card">
            <h3>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
            <p>–ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∏ –ø–æ–ª—É—á–∞–π –∑–≤–µ–∑–¥—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            <button id="daily-btn" class="buy-btn" style="background: #34c759;" onclick="claimBonus()">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-bar">
        <div class="nav-item active" onclick="switchTab('shop', this)">
            <div class="nav-icon">üõçÔ∏è</div>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </div>
        <div class="nav-item" onclick="switchTab('profile', this)">
            <div class="nav-icon">üë§</div>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
        const BOT_USERNAME = "QibysShopBot"; 
        // -----------------

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const user = tg.initDataUnsafe.user;
        
        if (user) {
            document.getElementById('username').innerText = user.first_name;
            document.getElementById('userid').innerText = user.id;
            if (user.photo_url) document.getElementById('avatar').src = user.photo_url;
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏
            const refLink = `https://t.me/${BOT_USERNAME}?start=${user.id}`;
            document.getElementById('ref-link').value = refLink;
        }

        // –£–±–∏—Ä–∞–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫
        setTimeout(() => {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 500);
        }, 800);

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName, el) {
            // –í–∏–±—Ä–∞—Ü–∏—è
            tg.HapticFeedback.selectionChanged();

            // UI –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏ (Telegram Stars)
        function buyItem(itemId, price) {
            tg.HapticFeedback.impactOccurred('medium');
            
            // –ó–¥–µ—Å—å –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É, —á—Ç–æ–±—ã –æ–Ω –≤—ã—Å—Ç–∞–≤–∏–ª —Å—á–µ—Ç
            // –ë–æ—Ç –ø–æ–ª—É—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ web_app_data
            tg.sendData(JSON.stringify({
                action: "buy",
                item: itemId,
                price: price
            }));
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–∫–∏
        function copyRef() {
            const copyText = document.getElementById("ref-link");
            copyText.select();
            document.execCommand("copy");
            tg.HapticFeedback.notificationOccurred('success');
            tg.showPopup({ title: "–£—Å–ø–µ—à–Ω–æ", message: "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!", buttons: [{type:"ok"}] });
        }

        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
        function share() {
            const link = document.getElementById("ref-link").value;
            tg.openTelegramLink(`https://t.me/share/url?url=${link}&text=–ó–∞—Ö–æ–¥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω Qibys, —Ç—É—Ç –∫—Ä—É—Ç–æ!`);
        }

        // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å (—Ñ–µ–π–∫ –ª–æ–≥–∏–∫–∞)
        function claimBonus() {
            const btn = document.getElementById('daily-btn');
            btn.innerText = "–ü–æ–ª—É—á–µ–Ω–æ ‚úÖ";
            btn.style.background = "#333";
            btn.disabled = true;
            tg.HapticFeedback.notificationOccurred('success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤–∏–∑—É–∞–ª—å–Ω–æ
            let bal = document.getElementById('stars-balance');
            bal.innerText = parseInt(bal.innerText) + 5;
            
            tg.showPopup({message: "–í—ã –ø–æ–ª—É—á–∏–ª–∏ 5 –±–æ–Ω—É—Å–Ω—ã—Ö –∑–≤–µ–∑–¥!"});
        }
    </script>
</body>
</html>
